config = (key)->
  ->
    @scope (all)->
      enable: ->
        all.where (o)->
          ! o.disabled

    class @model extends @model

Mem.conf = {}

<%
  for (key in confs) {
    switch (key) {
      case "input":
      case "store":
      case "say":
        continue;
      default:
        var data = confs[key];
 %>
new Mem.Rule("<%= key %>").schema config("<%= key %>")
<% }} %>

<%
  for (key in confs) {
    var data = confs[key];
 %>
Mem.Collection.<%- key %>.set <%- JSON.stringify(data) %>
<% } %>

<%
  for (key in confs) {
    var data = confs[key];
 %>
Mem.conf.<%- key %> = Mem.Query.<%- key %>s.hash
<% } %>
